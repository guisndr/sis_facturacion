{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block content %}
<div class="card">
    <div class="card-header"><h5>Reportes</h5></div>
    <div class="card-body">
        <form method="POST">
            {{ form.hidden_tag() }}
            {{ macros.render_field(form.fecha_desde) }}
            {{ macros.render_field(form.fecha_hasta) }}
            {{ macros.render_field(form.cliente_id) }}
            {{ form.submit(class="btn btn-primary") }}
        </form>
        {% if resultados.facturas %}
        <table class="table mt-3">
            <thead><tr><th>Fecha y hora</th><th>Cliente</th><th>Total</th></tr></thead>
            <tbody>
                {% for factura in resultados.facturas %}
                <tr>
                    <td>{{ factura.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>{{ factura.cliente.nombre }}</td>
                    <td>${{ "%.2f"|format(factura.total) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <p class="mt-3">Total ventas: ${{ "%.2f"|format(resultados.ventas_total) }}</p>
        {% else %}
        <p class="mt-3 text-muted">No hay facturas para el criterio seleccionado.</p>
        {% endif %}

        {% if resultados.por_cliente %}
        <h6 class="mt-4">Resumen por Cliente</h6>
        <table class="table table-sm">
            <thead><tr><th>Cliente</th><th>Cantidad de Facturas</th><th>Total</th></tr></thead>
            <tbody>
            {% for row in resultados.por_cliente %}
                <tr>
                    <td>{{ row.cliente_nombre }}</td>
                    <td>{{ row.cantidad }}</td>
                    <td>${{ "%.2f"|format(row.monto_total) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</div>
{% endblock %}